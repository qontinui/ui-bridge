"use strict";(globalThis.webpackChunkui_bridge_docs=globalThis.webpackChunkui_bridge_docs||[]).push([[4590],{7506(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"guides/web","title":"Web / Next.js Guide","description":"Complete guide for integrating UI Bridge with Next.js and other web applications, including auto-registration and render logging.","source":"@site/docs/guides/web.md","sourceDirName":"guides","slug":"/guides/web","permalink":"/ui-bridge/docs/guides/web","draft":false,"unlisted":false,"editUrl":"https://github.com/qontinui/ui-bridge/tree/main/docs-site/docs/guides/web.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Component State Exposure","permalink":"/ui-bridge/docs/advanced/component-state-exposure"},"next":{"title":"Tauri Desktop Guide","permalink":"/ui-bridge/docs/guides/tauri"}}');var i=t(4848),o=t(8453);const s={sidebar_position:1},d="Web / Next.js Guide",l={},a=[{value:"Installation",id:"installation",level:2},{value:"Basic Setup",id:"basic-setup",level:2},{value:"1. Add the Provider",id:"1-add-the-provider",level:3},{value:"2. Add the API Route",id:"2-add-the-api-route",level:3},{value:"3. Add Render Logging (Optional but Recommended)",id:"3-add-render-logging-optional-but-recommended",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"Using with Server Components",id:"using-with-server-components",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"Python Client Usage",id:"python-client-usage",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Elements Not Being Registered",id:"elements-not-being-registered",level:3},{value:"Render Log Empty",id:"render-log-empty",level:3},{value:"API 404 Errors",id:"api-404-errors",level:3},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"web--nextjs-guide",children:"Web / Next.js Guide"})}),"\n",(0,i.jsx)(n.p,{children:"Complete guide for integrating UI Bridge with Next.js and other web applications, including auto-registration and render logging."}),"\n",(0,i.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install ui-bridge ui-bridge-server\n"})}),"\n",(0,i.jsx)(n.h2,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,i.jsx)(n.h3,{id:"1-add-the-provider",children:"1. Add the Provider"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// app/layout.tsx (App Router)\nimport { UIBridgeProvider, AutoRegisterProvider } from 'ui-bridge/react';\n\nexport default function RootLayout({ children }) {\n  return (\n    <html>\n      <body>\n        <UIBridgeProvider\n          features={{\n            renderLog: true,\n            control: true,\n            debug: process.env.NODE_ENV === 'development',\n          }}\n        >\n          <AutoRegisterProvider enabled={process.env.NODE_ENV === 'development'}>\n            {children}\n          </AutoRegisterProvider>\n        </UIBridgeProvider>\n      </body>\n    </html>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-add-the-api-route",children:"2. Add the API Route"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// app/api/ui-bridge/[...path]/route.ts\nimport { createUIBridgeHandler } from 'ui-bridge-server/nextjs';\n\nconst handler = createUIBridgeHandler();\n\nexport const GET = handler;\nexport const POST = handler;\nexport const DELETE = handler;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-add-render-logging-optional-but-recommended",children:"3. Add Render Logging (Optional but Recommended)"}),"\n",(0,i.jsx)(n.p,{children:"Create a wrapper component that captures DOM snapshots on navigation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:'// lib/ui-bridge/RenderLogWrapper.tsx\n"use client";\n\nimport { useEffect, useRef, useCallback, type ReactNode } from "react";\nimport { usePathname, useSearchParams } from "next/navigation";\nimport { useUIBridgeOptional } from "ui-bridge/react";\n\nexport function RenderLogWrapper({\n  children,\n  enableOnMount = true,\n  enableMutationObserver = true,\n  mutationDebounceMs = 500,\n}: {\n  children: ReactNode;\n  enableOnMount?: boolean;\n  enableMutationObserver?: boolean;\n  mutationDebounceMs?: number;\n}) {\n  const pathname = usePathname();\n  const searchParams = useSearchParams();\n  const bridge = useUIBridgeOptional();\n  const isDev = process.env.NODE_ENV === "development";\n\n  const lastPathRef = useRef<string | null>(null);\n  const mutationTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const observerRef = useRef<MutationObserver | null>(null);\n\n  const fullPath = pathname + (searchParams?.toString() ? `?${searchParams.toString()}` : "");\n\n  // Capture snapshot helper\n  const captureSnapshot = useCallback(\n    async (trigger: string, metadata?: Record<string, unknown>) => {\n      if (!isDev || !bridge?.renderLog) return;\n\n      await new Promise((resolve) => requestAnimationFrame(resolve));\n      await bridge.renderLog.captureSnapshot({ trigger, pathname, ...metadata });\n    },\n    [isDev, bridge, pathname]\n  );\n\n  // Capture on route change\n  useEffect(() => {\n    if (!isDev || !bridge?.renderLog) return;\n    if (lastPathRef.current === fullPath) return;\n\n    const previousPath = lastPathRef.current;\n    lastPathRef.current = fullPath;\n\n    if (previousPath === null && enableOnMount) return;\n\n    const timeoutId = setTimeout(() => {\n      captureSnapshot("route_change", { previousPath, newPath: fullPath });\n    }, 100);\n\n    return () => clearTimeout(timeoutId);\n  }, [fullPath, isDev, bridge, captureSnapshot, enableOnMount]);\n\n  // Capture on mount\n  useEffect(() => {\n    if (!isDev || !bridge?.renderLog || !enableOnMount) return;\n\n    const timeoutId = setTimeout(() => {\n      captureSnapshot("mount");\n      lastPathRef.current = fullPath;\n    }, 500);\n\n    return () => clearTimeout(timeoutId);\n  }, [isDev, bridge]);\n\n  // Mutation observer\n  useEffect(() => {\n    if (!isDev || !bridge?.renderLog || !enableMutationObserver) return;\n\n    const observer = new MutationObserver((mutations) => {\n      const significant = mutations.some((m) => {\n        if (m.addedNodes.length || m.removedNodes.length) {\n          for (const node of m.addedNodes) {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n              const el = node as Element;\n              if (!["SCRIPT", "STYLE", "SVG"].includes(el.tagName)) return true;\n            }\n          }\n        }\n        return false;\n      });\n\n      if (significant) {\n        if (mutationTimeoutRef.current) clearTimeout(mutationTimeoutRef.current);\n        mutationTimeoutRef.current = setTimeout(() => {\n          captureSnapshot("mutation");\n        }, mutationDebounceMs);\n      }\n    });\n\n    observer.observe(document.body, { childList: true, subtree: true });\n    observerRef.current = observer;\n\n    return () => {\n      observer.disconnect();\n      if (mutationTimeoutRef.current) clearTimeout(mutationTimeoutRef.current);\n    };\n  }, [isDev, bridge, enableMutationObserver, mutationDebounceMs, captureSnapshot]);\n\n  return <>{children}</>;\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Update your layout to include it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// app/layout.tsx\nimport { UIBridgeProvider, AutoRegisterProvider } from 'ui-bridge/react';\nimport { RenderLogWrapper } from '@/lib/ui-bridge/RenderLogWrapper';\n\nexport default function RootLayout({ children }) {\n  return (\n    <html>\n      <body>\n        <UIBridgeProvider features={{ renderLog: true, control: true }}>\n          <AutoRegisterProvider enabled={process.env.NODE_ENV === 'development'}>\n            <RenderLogWrapper>\n              {children}\n            </RenderLogWrapper>\n          </AutoRegisterProvider>\n        </UIBridgeProvider>\n      </body>\n    </html>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,i.jsx)(n.p,{children:"Here's a full example showing all features:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// app/layout.tsx\nimport { UIBridgeProvider, AutoRegisterProvider } from 'ui-bridge/react';\nimport { RenderLogWrapper } from '@/lib/ui-bridge/RenderLogWrapper';\n\nconst UI_BRIDGE_ENABLED =\n  process.env.NEXT_PUBLIC_UI_BRIDGE_ENABLED === 'true' ||\n  process.env.NODE_ENV === 'development';\n\nexport default function RootLayout({ children }) {\n  if (!UI_BRIDGE_ENABLED) {\n    return <html><body>{children}</body></html>;\n  }\n\n  return (\n    <html>\n      <body>\n        <UIBridgeProvider\n          features={{\n            renderLog: true,\n            control: true,\n            debug: process.env.NODE_ENV === 'development',\n          }}\n          config={{\n            verbose: process.env.NODE_ENV === 'development',\n            maxLogEntries: 1000,\n          }}\n        >\n          {/* Auto-register all interactive elements */}\n          <AutoRegisterProvider\n            enabled={process.env.NODE_ENV === 'development'}\n            idStrategy=\"prefer-existing\"\n            debounceMs={100}\n            excludeSelectors={['[data-no-register]']}\n          >\n            {/* Capture DOM snapshots on navigation */}\n            <RenderLogWrapper\n              enableOnMount={true}\n              enableMutationObserver={true}\n              mutationDebounceMs={500}\n            >\n              {children}\n            </RenderLogWrapper>\n          </AutoRegisterProvider>\n        </UIBridgeProvider>\n      </body>\n    </html>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"using-with-server-components",children:"Using with Server Components"}),"\n",(0,i.jsx)(n.p,{children:'UI Bridge hooks require client components. For server components, use the "use client" directive:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-tsx",children:"// components/InteractiveButton.tsx\n\"use client\";\n\nimport { useUIElement } from 'ui-bridge/react';\n\nexport function InteractiveButton({ id, children, onClick }) {\n  const { ref } = useUIElement({\n    id,\n    type: 'button',\n    customActions: {\n      'custom-click': { handler: onClick },\n    },\n  });\n\n  return <button ref={ref} onClick={onClick}>{children}</button>;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# .env.local\nNEXT_PUBLIC_UI_BRIDGE_ENABLED=true  # Enable in production if needed\n"})}),"\n",(0,i.jsx)(n.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,i.jsx)(n.p,{children:"Once configured, these endpoints are available:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Endpoint"}),(0,i.jsx)(n.th,{children:"Method"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/api/ui-bridge/elements"})}),(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:"List registered elements"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/api/ui-bridge/elements/:id"})}),(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:"Get element details"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/api/ui-bridge/elements/:id/action"})}),(0,i.jsx)(n.td,{children:"POST"}),(0,i.jsx)(n.td,{children:"Execute element action"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/api/ui-bridge/components"})}),(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:"List registered components"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/api/ui-bridge/discover"})}),(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:"Auto-discover elements"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/api/ui-bridge/render-log"})}),(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:"Get render log entries"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/api/ui-bridge/snapshot"})}),(0,i.jsx)(n.td,{children:"GET"}),(0,i.jsx)(n.td,{children:"Get current DOM snapshot"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"python-client-usage",children:"Python Client Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from ui_bridge import UIBridgeClient\n\nclient = UIBridgeClient("http://localhost:3000")\n\n# List all registered elements\nelements = client.get_elements()\nfor el in elements:\n    print(f"{el.id}: {el.type}")\n\n# Click a button\nclient.click("submit-btn")\n\n# Type in an input\nclient.type("email-input", "user@example.com")\n\n# Get render log\nsnapshot = client.get_latest_snapshot()\nprint(f"Page title: {snapshot.data.page.title}")\n'})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"elements-not-being-registered",children:"Elements Not Being Registered"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Verify ",(0,i.jsx)(n.code,{children:"AutoRegisterProvider"})," is enabled"]}),"\n",(0,i.jsx)(n.li,{children:"Check element matches interactive selectors"}),"\n",(0,i.jsxs)(n.li,{children:["Add ",(0,i.jsx)(n.code,{children:"data-testid"})," or ",(0,i.jsx)(n.code,{children:"data-ui-id"})," attribute"]}),"\n",(0,i.jsx)(n.li,{children:"Check browser console for registration logs"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"render-log-empty",children:"Render Log Empty"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Verify ",(0,i.jsx)(n.code,{children:"renderLog: true"})," in features"]}),"\n",(0,i.jsxs)(n.li,{children:["Check ",(0,i.jsx)(n.code,{children:"RenderLogWrapper"})," is included"]}),"\n",(0,i.jsx)(n.li,{children:"Verify development mode is active"}),"\n",(0,i.jsx)(n.li,{children:"Check API endpoint is accessible"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"api-404-errors",children:"API 404 Errors"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Verify API route is created at correct path"}),"\n",(0,i.jsx)(n.li,{children:"Check route exports all HTTP methods"}),"\n",(0,i.jsx)(n.li,{children:"Verify Next.js is handling the catch-all route"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../react/auto-registration",children:"Auto-Registration"})," - Configuration options"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../react/render-logging",children:"Render Logging"})," - Capture configuration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../api/overview",children:"API Reference"})," - Full API documentation"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453(e,n,t){t.d(n,{R:()=>s,x:()=>d});var r=t(6540);const i={},o=r.createContext(i);function s(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);